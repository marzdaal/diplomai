# Техническая документация DiplomAI

> Этот документ — «живой» источник правды. Я буду возвращаться к нему для контекста и постоянно дописывать по мере развития проекта.

## 1. Обзор проекта
DiplomAI — это веб‑приложение, которое помогает сформировать цели и задачи дипломной работы, а затем собрать основу структуры документа и выгрузить её в Word‑файл. Приложение состоит из фронтенда на Next.js и бэкенда на FastAPI. Пользователь вводит тему диплома, получает потоковую выдачу целей и задач, может переформулировать или заменить отдельные пункты, а затем сформировать DOCX‑файл с титульным листом и примерной структурой работы.【F:backend/main.py†L1-L196】【F:frontend/src/app/page.tsx†L1-L472】

## 2. Архитектура
**Схема верхнего уровня**
- **Frontend (Next.js)** — UI, ввод данных, управление состоянием, вызовы API.
- **Backend (FastAPI)** — генерация целей/задач, служебные операции (перефраз/замена), генерация DOCX.
- **DOCX генератор** — формирует титульный лист и содержание на основе выбранного профиля (ГОСТ/МГУ/ВШЭ).【F:backend/main.py†L79-L196】

**Потоки данных**
1. Пользователь вводит тему → фронтенд вызывает `/generate`.
2. Бэкенд возвращает поток JSON‑строк (по цели/задаче) → фронтенд отображает карточки в реальном времени.
3. Пользователь нажимает «Переформулировать» или «Заменить» → запрос на `/items/{id}/rephrase` или `/items/{id}/replace`.
4. Пользователь выбирает профиль и заполняет титульный лист → запрос на `/documents/generate`, скачивание DOCX‑файла.【F:backend/main.py†L1-L196】【F:frontend/src/app/page.tsx†L1-L472】【F:frontend/src/lib/api.ts†L1-L83】

## 3. Стек технологий
- **Backend:** FastAPI, Pydantic, python-docx.【F:backend/main.py†L1-L196】
- **Frontend:** Next.js (App Router), React, TypeScript, Tailwind CSS.【F:frontend/src/app/page.tsx†L1-L472】
- **Формат данных:** JSON, потоковая выдача (newline‑delimited JSON).【F:backend/main.py†L52-L87】【F:frontend/src/lib/api.ts†L13-L38】

## 4. Структура репозитория
```
/workspace/diplomai
├── backend
│   ├── main.py          # FastAPI приложение и логика генерации
│   └── requirements.txt # зависимости бэкенда
├── frontend
│   ├── src
│   │   ├── app/page.tsx # основной UI
│   │   ├── components   # UI‑компоненты
│   │   └── lib          # API‑клиент и типы
│   └── package.json
└── docs
    └── TECHNICAL_DOC.md # этот документ
```

## 5. Бэкенд: API и логика
### 5.1. Эндпоинты
- `POST /generate`
  - **Вход:** `{ "topic": string }`.
  - **Выход:** поток JSON‑объектов (`goal`/`task`) в формате `\n`‑разделённых строк.
- `POST /items/{item_id}/rephrase`
  - **Вход:** `{ "type": "goal" | "task" }`.
  - **Выход:** `{ id, text }`.
- `POST /items/{item_id}/replace`
  - **Вход:** `{ "type": "goal" | "task" }`.
  - **Выход:** `{ id, text }`.
- `POST /documents/generate`
  - **Вход:** профиль оформления, данные титульного листа, массивы целей и задач.
  - **Выход:** Word‑файл (`.docx`) с структурой диплома и выбранными пунктами.【F:backend/main.py†L79-L196】

### 5.2. Генерация целей и задач
Бэкенд создает заранее подготовленные формулировки (пока без LLM) и отдает их потоково, имитируя «живую» генерацию. Это позволяет фронтенду показывать результат по мере поступления. Тайминги выдачи настроены с задержкой `~0.35-0.4s` между пунктами.【F:backend/main.py†L52-L77】

### 5.3. Генерация структуры документа
Формирование DOCX включает:
- титульный лист (университет, факультет, кафедра, название, ФИО и т. д.),
- содержание по профилю (ГОСТ/МГУ/ВШЭ),
- список целей и задач. 【F:backend/main.py†L109-L173】

## 6. Фронтенд: ключевая логика
### 6.1. Состояния
- `topic`, `goals`, `tasks` — входная тема и результаты генерации.
- `isGenerating`, `isGeneratingDoc`, `error`, `docError` — состояния загрузок и ошибок.
- `profile`, `form` — выбранный профиль документа и поля титульного листа.【F:frontend/src/app/page.tsx†L8-L56】

### 6.2. Управление генерацией
- `streamGenerate` читает поток и обновляет UI по мере поступления данных.
- `rephraseItem` и `replaceItem` обновляют конкретный элемент в списке.
- `generateDocument` скачивает Word‑файл по сформированному payload.【F:frontend/src/app/page.tsx†L20-L173】【F:frontend/src/lib/api.ts†L1-L83】

## 7. Конфигурация окружения
- `NEXT_PUBLIC_API_URL` — базовый URL бэкенда. Если не задан, используется `http://localhost:8000`.【F:frontend/src/lib/api.ts†L3-L5】

## 8. Как запустить локально (черновик)
> Дополнить деталями запуска после уточнения стандартных команд.

**Backend:**
1. Перейти в `/workspace/diplomai/backend`.
2. Установить зависимости из `requirements.txt`.
3. Запустить FastAPI (например, через `uvicorn main:app --reload`).

**Frontend:**
1. Перейти в `/workspace/diplomai/frontend`.
2. Установить зависимости из `package.json`.
3. Запустить Next.js dev server.

## 9. Принятые решения и ограничения
- Пока используется шаблонная генерация целей/задач, без внешнего LLM.
- DOCX‑структуры зафиксированы на уровне профилей (ГОСТ/МГУ/ВШЭ).【F:backend/main.py†L79-L137】

## 10. Backlog для расширения документации
- [ ] Описание фактических команд запуска (npm scripts, uvicorn).
- [ ] Описание схемы дизайна и UI‑компонентов.
- [ ] Описание тестов и CI.
- [ ] Описание вариантов деплоя.

---

**История изменений документа**
- 2025‑XX‑XX: создан начальный черновик технической документации.
